<template>
  <div class="container">
    <h1 class="title">Solicitações de Saque</h1>
    <div class="flex space-between flex-row vertical-center">
      <p>
        Filtrando por:
        <span
          style="margin-left: 5px"
          :class="[
            'status',
            { pendent: searchStatus === 0 || !searchStatus },
            { confirmed: searchStatus === 1 }
          ]"
        >
          <span v-if="searchStatus === 0 || !searchStatus" class="is-dark">
            Pendente
          </span>
          <span v-else-if="searchStatus === 1" class="is-dark">Realizado</span>
        </span>
      </p>
      <div class="filter" @click="setAddFundsModal(true)">
        <uil-filter size="30px" />
        <p class="is-green">Filtrar</p>
      </div>
    </div>
    <div class="card-list">
      <Card v-for="(withdrawal, index) in withdraws" :key="withdrawal._id">
        <div class="flex flex-column" style="flex: 1;">
          <div class="flex space-between flex-row top header">
            <h4>
              Solicitação de saque n°
              {{ index + 1 > 99 ? `${index}` : `0${index + 1}` }}
            </h4>
            <p>{{ withdrawal.createdAt | dateFilter }}</p>
          </div>
          <div class="flex space-between flex-row vertical-center">
            <div :class="['status', { pendent: withdrawal.status === 0 }]">
              {{ withdrawal.status === 0 && 'Pendente' }}
            </div>
            <div class="payment flex space-around" style="flex: 0.80;">
              <p class="is-pink">*{{ withdrawal.method }}</p>
              <p class="is-green">
                {{
                  withdrawal.Withdraw.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                  })
                }}
              </p>
            </div>
          </div>
        </div>
      </Card>
    </div>
    <modal>
      <template v-slot:header>
        <h1 class="title fs-medium">Filtrar Solicitações de Saque</h1>
      </template>
      <template v-slot:body>
        <h3 class="lighter">Status do Saque:</h3>
        <div class="flex flex-row vertical-center">
          <label for="pendentStatus" class="label">Pendente: </label>
          <input
            type="radio"
            id="pendentStatus"
            value="0"
            v-model.number.lazy="searchStatus"
          />
        </div>
        <div class="flex flex-row vertical-center">
          <label for="confirmedStatus" class="label">Realizado: </label>
          <input
            type="radio"
            id="confirmedStatus"
            value="1"
            v-model.number.lazy="searchStatus"
          />
        </div>
      </template>
      <template v-slot:footer>
        <div>
          <button
            class="button button__ghost button__danger"
            @click="closeModal"
          >
            Cancelar
          </button>
          <button class="button button__primary" @click="fetchWithdrawals">
            Salvar
          </button>
        </div>
      </template>
    </modal>
  </div>
</template>

<script>
import Card from '@/components/Card.vue'
import Modal from '@/components/Modal.vue'

import { format } from 'date-fns'
import { UilFilter } from '@iconscout/vue-unicons'

import fontawesome from '@fortawesome/fontawesome'
import faSolid from '@fortawesome/fontawesome-free-solid'

import { mapMutations } from 'vuex'

export default {
  components: { Modal, Card, UilFilter },
  data: () => ({
    withdraws: [],
    searchStatus: null
  }),
  filters: {
    dateFilter(timestamp) {
      const date = new Date(timestamp)
      return format(date, 'dd/MM/yyyy')
    }
  },
  methods: {
    ...mapMutations(['setAddFundsModal']),
    closeModal() {
      this.searchStatus = null
      this.setAddFundsModal(false)
    },
    async fetchWithdrawals() {
      try {
        const { data } = await this.$axios.get(
          `/user/withdraw/${this.searchStatus || ''}`
        )
        if (data.withdraws) {
          this.withdraws = data.withdraws
        }
      } catch (_e) {
        this.$toasted.show(
          `${
            fontawesome.icon(faSolid.faExclamationTriangle).html
          } Não foi possível realizar a consulta das solicitações`,
          {
            duration: 10000,
            position: 'top-center',
            fullWidth: true,
            className: 'toasty'
          }
        )
      } finally {
        this.setAddFundsModal(false)
      }
    }
  },
  created() {
    this.fetchWithdrawals()
  }
}
</script>

<style lang="scss" scoped>
.container {
  .status {
    width: 75px;
    height: 20px;
    border-radius: 25px;
    text-align: center;
    padding: 5px 15px;
    color: $background;
    font-weight: bold;
    font-family: 'Quicksand', sans-serif;
    &.pendent {
      background: $warning;
    }
    &.confirmed {
      background: $accent;
    }
  }
  .payment {
    p {
      font-size: 22px;
    }
  }

  .card-list {
    .header {
      h4,
      p {
        margin: 15px 0;
      }
    }
  }

  .filter {
    .ui-svg-inline {
      color: $accent;
    }

    display: flex;
    align-items: center;
    flex-direction: column;

    p {
      margin: 0;
    }
    &:hover {
      cursor: pointer;
    }
  }

  input[type='radio'] {
    width: 25px;
    height: 25px;
    margin-left: 15px;
    &:hover {
      background-color: red;
    }
  }
  label.label {
    margin-top: 0;
  }
}
</style>
